---
title: v831使用记录
date: 2021-09-10 10:19:13
categories: "sipeed"
tags:
---
# v831使用记录

#### 一、常用命令

##### 查询vi命令

```
cat /sys/kernel/debug/mpp/vi
```

##### 通过shell操作PWM

```
# 查看PWM状态
cat /sys/kernel/debug/pwm
# 设置PWM
echo 9 > /sys/class/pwm/pwmchip0/export && echo 100000 > /sys/class/pwm/pwmchip0/pwm9/period && echo 20000 > /sys/class/pwm/pwmchip0/pwm9/duty_cycle && echo 1 > /sys/class/pwm/pwmchip0/pwm9/enable
```

##### 读/写v833寄存器值

```
# 读
echo 0x0300B074 > /sys/class/sunxi_dump/dump			# 0x0300B074 表示寄存器地址
cat /sys/class/sunxi_dump/dump

# 写
echo 0x0300B0FC 0x74471277 > /sys/class/sunxi_dump/write    # 0x0300B0FC是寄存器地址，0x0x74471277是寄存器值
```

##### 编译83x系统镜像后导出设备树

```
cd sdk/out/v833-perf1
dd if=./image/sunxi.dtb of=sipeed.dtb bs=72k count=1 conv=sync
```

##### 从83x系统镜像中导出设备树

```
adb shell
dd if=/dev/mmcblk0 of=sipeed.dtb bs=72k count=1 conv=sync
```

##### 通过shell让lcd显示图片

```
# 参数1可以修改为1，2，3，4等等
echo 1 > /sys/class/disp/disp/attr/colorbar
# 恢复原图
echo 0 > /sys/class/disp/disp/attr/colorbar
```

##### 以hex格式打印数据

```
hexdump ./sys/kernel/debug/dispdbg/start
```

##### 在v833上打印系统内存情况

通过访问/proc/meminfo文件获取内存的实时情况，指令参考:`cat /proc/meminfo | grep MemFree`

```
static void print_mem(int line)
{
  FILE *fp = NULL;
  char msg[100] = {0};
  fp = popen("cat /proc/meminfo | grep MemFree", "r");
  if (fp)
  {
    fread(msg, sizeof(char), sizeof(msg), fp);
    printf(" line:%d========== %s\n\n", line, msg);
  }
  else
  {
    perror("print mem popen err");
  }
}
```

##### v83x打包后部分脚本默认没有可执行权限的问题

在打包（pack）前手动给对应的文件赋予权限

```
chmod +x v831_SDK/sdk/target/allwinner/v833-perf1/busybox-init-base-files/etc/init.d
chmod +x v831_SDK/sdk/target/allwinner/v833-perf1/busybox-init-base-files/home/keygen
chmod +x v831_SDK/sdk/target/allwinner/v833-perf1/busybox-init-base-files/usr/bin
```

##### 清除cache缓存

通过给/proc/sys/vm/drop_caches赋值可以选择释放缓存，drop_cache可以有4个值(0~3)，含义为：
1. 0,不释放
2. 1,释放页缓存
3. 2,释放dentries和inodes（inode是文件的数据结构，dentries是目录的数据结构）
4. 3，释放所有缓存

```
echo 3 > /proc/sys/vm/drop_caches
```